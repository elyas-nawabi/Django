"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var kendo_react_dateinputs_1 = require("@progress/kendo-react-dateinputs");
var kendo_react_intl_1 = require("@progress/kendo-react-intl");
var constants_1 = require("../../../constants");
var kendo_react_buttons_1 = require("@progress/kendo-react-buttons");
var SchedulerContext_1 = require("../../../context/SchedulerContext");
var kendo_date_math_1 = require("@progress/kendo-date-math");
var utils_1 = require("../../../utils");
/** @hidden */
exports.NavigationDatePicker = React.forwardRef(function (props, ref) {
    var timezone = SchedulerContext_1.useSchedulerPropsContext().timezone;
    var normalized = kendo_date_math_1.ZonedDate.fromLocalDate(props.value, timezone);
    var value = kendo_date_math_1.getDate(normalized);
    var handleChange = React.useCallback(function (event) {
        if (props.onChange) {
            var normalizedValue = kendo_date_math_1.ZonedDate.fromUTCDate(utils_1.toUTCDateTime(event.value), timezone);
            props.onChange.call(undefined, __assign({}, event, { value: normalizedValue }));
        }
    }, [props.onChange]);
    return (React.createElement(kendo_react_dateinputs_1.DatePicker, __assign({ ref: ref, dateInput: EMPTY_DATE_INPUT, pickerWrap: EMPTY_PICKER_WRAP, toggleButton: SchedulerNavigationDatePickerToggleButton }, props, { value: value, onChange: handleChange })));
});
var EMPTY_DATE_INPUT = function () { return null; };
var EMPTY_PICKER_WRAP = function (props) { return React.createElement(React.Fragment, null, props.children); };
var SchedulerNavigationDatePickerToggleButton = function (props) {
    var intl = kendo_react_intl_1.useInternationalization();
    var _a = SchedulerContext_1.useSchedulerDateFormatContext(), dateFormat = _a.dateFormat, shortDateFormat = _a.shortDateFormat;
    var dateRange = SchedulerContext_1.useSchedulerDateRangeContext();
    var date = SchedulerContext_1.useSchedulerDateContext()[0];
    var isMonthView = dateRange.end.getTime() - dateRange.start.getTime() > constants_1.MS_PER_DAY * 27;
    var text = intl.format(dateFormat, isMonthView
        ? date
        : dateRange.zonedStart, isMonthView
        ? date
        : dateRange.zonedEnd.addDays(-1));
    var shortText = intl.format(shortDateFormat, isMonthView
        ? date
        : dateRange.zonedStart, isMonthView
        ? date
        : dateRange.zonedEnd.addDays(-1));
    return (React.createElement(kendo_react_buttons_1.Button, __assign({}, props, { className: "k-nav-current", tabIndex: -1, look: 'flat' }),
        React.createElement("span", { className: "k-icon k-i-calendar" }),
        React.createElement("span", { className: "k-sm-date-format" }, shortText),
        React.createElement("span", { className: "k-lg-date-format" }, text)));
};
//# sourceMappingURL=NavigationDatePicker.js.map